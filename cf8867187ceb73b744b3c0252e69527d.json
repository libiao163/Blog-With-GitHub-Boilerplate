{"posts": [{"title": "Rabbitmq \u9ad8\u53ef\u7528", "date": "2020-01-19T15:23:00-00.00", "path": "/archives/Rabbitmq_HA/", "text": "\u4e00 HA\u65b9\u6848\n\u4f7f\u7528rabbitmq\u96c6\u7fa4\uff0c\u4e00\u65b9\u9762\u662f\u60f3\u901a\u8fc7\u96c6\u7fa4\u63d0\u5347\u6d88\u606f\u7684\u5904\u7406\u901f\u5ea6\uff1b\u53e6\u4e00\u65b9\u9762\uff0c\u9632\u6b62\u4e00\u4e2a\u8282\u70b9\u4e0d\u53ef\u7528\u5bfc\u81f4\u6574\u4e2a\u5e73\u53f0\u51fa\u73b0\u6545\u969c\u3002\u4f7f\u7528\u96c6\u7fa4\u540e\uff0c\u5f53\u4e00\u4e2a\u8282\u70b9\u51fa\u73b0\u6545\u969c\u540e\uff0c\u9700\u8981\u67d0\u79cd\u65b9\u6cd5\u4f7f\u5f97\u5ba2\u6237\u7aef\u611f\u77e5\uff0c\u5207\u6362\u5230\u65e0\u6545\u969c\u7684\u8282\u70b9\uff0c\u8fbe\u5230HA \u7684\u76ee\u7684\u3002\nrabbimq \u6709\u4e24\u79cdHA \u65b9\u6848\uff1a\n\n\u589e\u52a0\u96c6\u7fa4\u7ba1\u7406\u5668\uff08\u5982\uff1aPacemaker\uff09\u5728\u96c6\u7fa4node \u51fa\u6545\u969c\u65f6\u611f\u77e5\u5e76\u5904\u7406\n\n\u5ba2\u6237\u7aef\u611f\u77e5\u6545\u969c\uff0c\u81ea\u52a8\u5207\u6362\n\n\n\u5bf9\u4e8e\u4ee5\u4e0a\u4e24\u79cd\uff0c\u589e\u52a0pacemaker\u5728\u7f16\u5199\u5ba2\u6237\u7aef\u65f6\uff0c\u4e0d\u7528\u8003\u8651\u600e\u4e48\u5904\u7406\u96c6\u7fa4\u6545\u969c\u3002\u5ba2\u6237\u7aef\u5b9e\u73b0\u6bd4\u8f83\u7b80\u5355\u3002\u589e\u52a0pacemaker \u76f8\u5f53\u4e8e\u589e\u52a0\u4e86\u4e00\u5c42\uff0c\u6240\u4ee5\u53c8\u8981\u8003\u8651pacemaker\u7684HA\uff0cpacemaker\u6210\u4e3a\u4e86\u5355\u70b9\uff0c\u5176\u51fa\u73b0\u6545\u969c\u5c06\u4f1a\u662f\u6574\u4e2a\u96c6\u7fa4\u7684\u6545\u969c\u3002\n\u5ba2\u6237\u7aef\u81ea\u884c\u611f\u77e5\u6545\u969c\uff0c\u9700\u8981\u5b9e\u73b0 pacemaker \u7c7b\u4f3c\u7684\u529f\u80fd\uff1a \u611f\u77e5\u6545\u969c\uff0c\u5207\u6362\u5230\u6b63\u786e\u8282\u70b9\uff0c\u6062\u590d\u72b6\u6001\u3002\u7ed9\u5ba2\u6237\u7aef\u7684\u7f16\u5199\u5e26\u6765\u590d\u6742\u5ea6\u3002\u4f46\u662f\u4e5f\u56e0\u4e3a\u5c11\u4e86\u4e00\u5c42\uff0c\u6545\u969c\u57df\u4f1a\u51cf\u5c11\u3002\n\u4ee5\u4e0a\u4e24\u79cd\u529f\u80fd\uff0c\u51fa\u73b0\u6545\u969c\uff0c\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u8282\u70b9\u65f6\uff0c\u53ef\u4ee5\u5f97\u5230\u6545\u969c\u8282\u70b9\u76f8\u540c\u7684\u4fe1\u606f\u3002rabbitmq \u672c\u8eab\u63d0\u4f9b\u4e86\u8fd9\u65b9\u9762\u7684\u529f\u80fd\uff1a\u955c\u50cf\u961f\u5217\u3002\n\u955c\u50cf\u961f\u5217\u53ef\u4ee5\u4fdd\u8bc1\u591a\u4e2a\u8282\u70b9\u6709\u76f8\u540c\u7684\u4fe1\u606f\uff0c\u8fd9\u6837\u5c31\u4f7f\u5f97\u5ba2\u6237\u7aef\u53d1\u73b0\u6545\u969c\u5728\u91cd\u8fde\u65f6\u6062\u590d\u81f3\u6545\u969c\u4e4b\u524d\u7684\u72b6\u6001\u3002\n1.1 rabbitmq \u955c\u50cf\u961f\u5217\n\u4ece 3.6.0 \u7248\u672c\u5f00\u59cb\uff0cRabbitMQ \u652f\u6301\u955c\u50cf\u961f\u5217\u529f\u80fd\uff0c\u5b98\u65b9\u6587\u6863\u5728\u8fd9\u91cc\u3002\u4e0e\u666e\u901a\u96c6\u7fa4\u76f8\u6bd4\uff0c\u5176\u5b9e\u8d28\u548c\u666e\u901a\u6a21\u5f0f\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u6d88\u606f\u5b9e\u4f53\u4f1a\u4e3b\u52a8\u5728\u955c\u50cf\u8282\u70b9\u95f4\u540c\u6b65\uff0c\u800c\u4e0d\u662f\u5728 consumer \u53d6\u6570\u636e\u65f6\u4e34\u65f6\u62c9\u53d6\u3002\u8be5\u6a21\u5f0f\u5e26\u6765\u7684\u526f\u4f5c\u7528\u4e5f\u5f88\u660e\u663e\uff0c\u9664\u4e86\u964d\u4f4e\u7cfb\u7edf\u6027\u80fd\u5916\uff0c\u5982\u679c\u955c\u50cf\u961f\u5217\u6570\u91cf\u8fc7\u591a\uff0c\u52a0\u4e4b\u5927\u91cf\u7684\u6d88\u606f\u8fdb\u5165\uff0c\u96c6\u7fa4\u5185\u90e8\u7684\u7f51\u7edc\u5e26\u5bbd\u5c06\u4f1a\u88ab\u8fd9\u79cd\u540c\u6b65\u901a\u8baf\u5927\u5927\u6d88\u8017\u6389\u3002\u6240\u4ee5\u5728\u5bf9\u53ef\u9760\u6027\u8981\u6c42\u8f83\u9ad8\u7684\u573a\u5408\u4e2d\u9002\u7528\u3002\n\nMirrorred queue \u662f RabbitMQ \u9ad8\u53ef\u7528\u7684\u4e00\u79cd\u65b9\u6848\uff0c\u76f8\u5bf9\u4e8e\u666e\u901a\u7684\u96c6\u7fa4\u65b9\u6848\u6765\u8bb2\uff0cqueue\u4e2d\u7684\u6d88\u606f\u6bcf\u4e2a\u8282\u70b9\u90fd\u4f1a\u5b58\u5728\u4e00\u4efd copy, \u8fd9\u4e2a\u5728\u5355\u4e2a\u8282\u70b9\u5931\u6548\u7684\u60c5\u51b5\u4e0b\uff0c\u6574\u4e2a\u96c6\u7fa4\u4ecd\u65e7\u53ef\u4ee5\u63d0\u4f9b\u670d\u52a1\u3002\u4f46\u662f\u7531\u4e8e\u6570\u636e\u9700\u8981\u5728\u591a\u4e2a\u8282\u70b9\u590d\u5236\uff0c\u5728\u589e\u52a0\u53ef\u7528\u6027\u7684\u540c\u65f6\uff0c\u7cfb\u7edf\u7684\u541e\u5410\u91cf\u4f1a\u6709\u6240\u4e0b\u964d\u3002\n\n\u9009\u4e3e\u673a\u5236\uff1amirror queue \u5185\u90e8\u5b9e\u73b0\u4e86\u4e00\u5957\u9009\u4e3e\u7b97\u6cd5\uff0c\u6709\u4e00\u4e2a master \u548c\u591a\u4e2aslave\uff0cqueue \u4e2d\u7684\u6d88\u606f\u4ee5 master \u4e3a\u4e3b\u3002\u955c\u50cf\u961f\u5217\u6709\u4e3b\u4ece\u4e4b\u5206\uff0c\u4e00\u4e2a\u4e3b\u8282\u70b9(master)\uff0c0\u4e2a\u6216\u591a\u4e2a\u4ece\u8282\u70b9(slave)\u3002\u5f53master\u5b95\u6389\u540e\uff0c\u4f1a\u5728 slave \u4e2d\u9009\u4e3e\u65b0\u7684master\uff0c\u5176\u9009\u4e3e\u7b97\u6cd5\u4e3a\u6700\u65e9\u542f\u52a8\u7684\u8282\u70b9\u3002 \u82e5master\u8282\u70b9\u5931\u6548\uff0c\u5219 mirror queue \u4f1a\u81ea\u52a8\u9009\u4e3e\u51fa\u4e00\u4e2a\u8282\u70b9\uff08slave\u4e2d\u6d88\u606f\u961f\u5217\u6700\u957f\u8005\uff09\u4f5c\u4e3amaster\uff0c\u4f5c\u4e3a\u6d88\u606f\u6d88\u8d39\u7684\u57fa\u51c6\u53c2\u8003; \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u53ef\u80fd\u5b58\u5728ack\u6d88\u606f\u672a\u540c\u6b65\u5230\u6240\u6709\u8282\u70b9\u7684\u60c5\u51b5(\u9ed8\u8ba4\u5f02\u6b65)\uff0c\u82e5 slave \u8282\u70b9\u5931\u6548\uff0cmirror queue \u96c6\u7fa4\u4e2d\u5176\u4ed6\u8282\u70b9\u7684\u72b6\u6001\u65e0\u9700\u6539\u53d8\u3002\u6240\u4ee5\uff0c\u770b\u8d77\u6765\u53ef\u4ee5\u4f7f\u7528\u4e24\u8282\u70b9\u7684\u955c\u50cf\u961f\u5217\u96c6\u7fa4\u3002\n\n\u4f7f\u7528\uff1a\u5bf9\u4e8epublish\uff0c\u53ef\u4ee5\u9009\u62e9\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u8fdb\u884c\u8fde\u63a5\uff0crabbitmq\u5185\u90e8\u82e5\u8be5\u8282\u70b9\u4e0d\u662fmaster\uff0c\u5219\u8f6c\u53d1\u7ed9master\uff0cmaster\u5411\u5176\u4ed6slave\u8282\u70b9\u53d1\u9001\u8be5\u6d88\u606f\uff0c\u540e\u8fdb\u884c\u6d88\u606f\u672c\u5730\u5316\u5904\u7406\uff0c\u5e76\u7ec4\u64ad\u590d\u5236\u6d88\u606f\u5230\u5176\u4ed6\u8282\u70b9\u5b58\u50a8\uff1b\u5bf9\u4e8econsumer\uff0c\u53ef\u4ee5\u9009\u62e9\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u8fdb\u884c\u8fde\u63a5\uff0c\u6d88\u8d39\u7684\u8bf7\u6c42\u4f1a\u8f6c\u53d1\u7ed9master,\u4e3a\u4fdd\u8bc1\u6d88\u606f\u7684\u53ef\u9760\u6027\uff0cconsumer\u9700\u8981\u8fdb\u884cack\u786e\u8ba4\uff0cmaster\u6536\u5230ack\u540e\uff0c\u624d\u4f1a\u5220\u9664\u6d88\u606f\uff0cack\u6d88\u606f\u4f1a\u540c\u6b65(\u9ed8\u8ba4\u5f02\u6b65)\u5230\u5176\u4ed6\u5404\u4e2a\u8282\u70b9\uff0c\u8fdb\u884cslave\u8282\u70b9\u5220\u9664\u6d88\u606f\u3002\n\n\n1.2 \u955c\u50cf\u961f\u5217\u7684A/A + Haproxy\nhttp://greenstack.die.upm.es/2015/03/02/improving-ha-failures-with-tcp-timeouts/ \u8fd9\u7bc7\u6587\u7ae0\u8be6\u7ec6\u8bb2\u89e3\u4e86\u5f53\u4e00\u4e2a\u8282\u70b9down\u6389\u540e,\u600e\u4e48\u5904\u7406.\u8fd9\u91cc\u4f9d\u7136\u8981\u542f\u7528\u955c\u50cf\u961f\u5217,\u4e14\u5f15\u5165\u4e86HAproxy\u8fd9\u4e2a\u7ec4\u4ef6,\u589e\u52a0\u4e86\u98ce\u9669\n\u597d\u5904\uff1a\nhaproxy \u53ef\u4ee5\u5206\u6563\u8fde\u63a5\uff0c\u4e0d\u81f3\u4e8e\u4e00\u4e2a\u8282\u70b9\u8d1f\u8f7d\u8fc7\u91cd\u3002\n1.3 \u955c\u50cf\u961f\u5217A/A + \u5ba2\u6237\u7aef heartbeat\n\u5ba2\u6237\u7aef\u4fdd\u8bc1HA\uff0c\nopenstack \u5bf9\u4e8emq \u7684\u4f7f\u7528\uff0c\u5c01\u88c5\u4e86\u4e00\u4e2a sdk\u2013oslo_message,\u5e76\u5bf9mq \u7684\u96c6\u7fa4\u573a\u666f\u505a\u4e86\u4f18\u5316\uff0c\u5982\u4e0b\uff1a\n\n\u914d\u7f6e\u591a\u4e2amq node\nheartbeat \u529f\u80fd\u68c0\u6d4b\u5f02\u5e38(rpc server \u4f7f\u7528\u53e6\u4e00\u79cd\u68c0\u67e5\u65b9\u5f0f\uff0c\u7c7b\u4f3c heartbeat )\n\u6253\u6563\u8fde\u63a5\u9632\u6b62\u4e00\u4e2a\u8282\u70b9\u8d1f\u62c5\u8fc7\u91cd\n\u4ee5\u4e0a\u4e09\u4e2a\u529f\u80fd\uff0c\u53ef\u4ee5\u4f7f\u5f97\u5ba2\u6237\u7aef\u81ea\u884c\u5224\u65ad\u96c6\u7fa4\u662f\u5426\u51fa\u4e86\u6545\u969c\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e0d\u4f7f\u7528LB ,\u51cf\u5c11\u4e86\u56e0Haproxy\u6545\u969c\u5e26\u6765\u7684\u95ee\u9898\u3002\u4e5f\u56e0\u4e3a\u6ca1\u6709\u4e2d\u95f4\u4ef6\uff0c\u7f29\u5c0f\u4e86\u6545\u969c\u57df\uff0c\u5ba2\u6237\u7aef\u4fdd\u8bc1HA \n\n\u4e8c rabbitmq HA\n2.1 \u96c6\u7fa4\u8981\u6c42\n\u4e00\u822c\u6211\u4eec\u96c6\u7fa4\u4f7f\u7528\u4e09\u4e2a\u8282\u70b9\uff0c\u5728\u96c6\u7fa4\u80fd\u529b\u4e0d\u591f\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u9002\u5f53\u589e\u52a0  rabbitmq \u8282\u70b9\u4e2a\u6570\uff0c\u6a2a\u5411\u6269\u5c55\u589e\u52a0\u96c6\u7fa4\u541e\u5410\u91cf\u3002\n\u9488\u5bf9\u4e09\u4e2a\u8282\u70b9\uff0c\u9700\u8981\u4fdd\u8bc1\u5176\u4e2d\u4e00\u4e2a\u8282\u70b9\u6216\u8005\u4e24\u4e2a\u8282\u70b9down\u6389\uff0c\u96c6\u7fa4\u4f9d\u7136\u53ef\u4ee5\u7ee7\u7eed\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002\u6240\u4ee5\u8981\u6c42\n\n\u5c3d\u91cf\u5728\u4e09\u4e2a\u4e0d\u540c\u7684\u673a\u67dc\u4e0a\n\u8fde\u63a5\u4e09\u4e2a\u4e0d\u540c\u7684\u4ea4\u6362\u673a\n\n2.2 \u96c6\u7fa4\u914d\u7f6e\n\u4e09\u4e2a\u8282\u70b9\uff0c\u4e24\u4e2aDISK\u8282\u70b9\uff0c\u4e00\u4e2aRAM\u8282\u70b9\n\u4e09 \u96c6\u7fa4\u964d\u7ea7\u7b56\u7565\n\u601d\u8003\u7684\u95ee\u9898\uff1a\n1 \u5728HA \u5df2\u7ecf\u6ee1\u8db3\u7684\u6761\u4ef6\u4e0b\uff0c\u4ec0\u4e48\u65f6\u5019\u9700\u8981\u5207\u6362\u5230\u5907\u7528\u96c6\u7fa4\nrabbitmq node \u5c3d\u91cf\u5728\u4e09\u4e2a\u4e0d\u540c\u7684\u673a\u67dc\u4e0a\uff0c\u8fde\u63a5\u4e09\u4e2a\u4e0d\u540c\u7684\u4ea4\u6362\u673a\u3002\u5982\u679c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u53d1\u751f\u6545\u969c\uff0c\u5982\u679c\u9700\u8981\u5bf9\u5916\u7ee7\u7eed\u63d0\u4f9b\u60a8\u670d\u52a1\uff0c\u9700\u8981\u8003\u8651\u7684\u8fde\u540c controller \u8282\u70b9\u4e00\u8d77\uff0c\u505a\u5230\u673a\u623f\u7684HA\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0capi \u4e0a\u5c42\u8d1f\u8f7d\u5747\u8861\u53ef\u4ee5\u505a\u5230\u6d41\u91cf\u5207\u6362\u3002mq \u964d\u7ea7\u5230\u5907\u4efd\u96c6\u7fa4\u3002\n2 \u5907\u7528\u96c6\u7fa4\u600e\u4e48\u81ea\u52a8\u5207\u6362\n\n\u624b\u52a8\u5207\u6362oslo \u914d\u7f6e\n\u4fee\u6539oslo message \u7ec4\u4ef6\uff0c\u5f53\u6ee1\u8db3\u4e00\u5b9a\u6761\u4ef6\u540e\u81ea\u52a8\u5207\u6362\n\n", "categories": [{"name": "message", "slug": "message", "permalink": "/category/message/"}], "tags": [{"name": "Rabbitmq", "slug": "Rabbitmq", "permalink": "/tag/Rabbitmq/"}]}, {"title": "DRF \u5e8f\u5217\u5316\u53cd\u5e8f\u5217\u5316", "date": "2019-12-31T17:23:00-00.00", "path": "/archives/Python_Django_REST_framework/", "text": "1. \u5904\u7406\u6d41\u7a0b\n1.1 \u53cd\u5e8f\u5217\u5316(\u6570\u636e\u5165\u5e93)\uff1a\n\u5728creat e\u65b9\u6cd5\u4e2d\u628a\u5173\u8054\u6570\u636e\u5355\u72ec\u62ff\u51fa\u6765\uff0c\u5148\u6b63\u5e38\u5904\u7406\u5176\u4e2d\u4e00\u4e2a\u6a21\u578b\u7684\u6570\u636e(\u5982\u679c\u662f\u591a\u5bf9\u4e00\u5173\u7cfb\uff0c\u5219\u9700\u8981\u5148\u521b\u5efa\u201c\u4e00\u201d\u8fd9\u4e2a\u6a21\u578b\u7684\u6570\u636e)\uff0c \u518d\u8c03\u7528\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\u5904\u7406\u53e6\u4e00\u4e2a\u6a21\u578b\u7684\u6570\u636e\u3002\n1.2 \u5e8f\u5217\u5316(\u6570\u636e\u5c55\u793a)\uff1a\n\u5728to_representation\u65b9\u6cd5\u4e2d\u5148\u6b63\u5e38\u53d6\u51fa\u5176\u4e2d\u4e00\u4e2a\u6a21\u578b\u7684\u6570\u636e\uff0c\u518d\u5c06\u53e6\u4e00\u4e2a\u6a21\u578b\u7684\u6570\u636e\u589e\u52a0\u5230\u5df2\u7ecf\u67e5\u8be2\u51fa\u7684\u6570\u636e\u4e2d\u3002\n1.3 \u573a\u666f\n\u9700\u8981\u5c06\u670d\u52a1\u5668\u76f8\u5173\u7684\u6570\u636e\u5b58\u5165\u5230\u6570\u636e\u5e93\u4e2d\u5e76\u5728\u524d\u7aef\u5c55\u793a\u3002\u670d\u52a1\u5668\u5305\u62ec\u5b9e\u4f8bID\u3001CPU\u3001\u5185\u5b58\u7b49\u552f\u4e00\u4e14\u5fc5\u9700\u7684\u53c2\u6570\uff0c\u4e5f\u5305\u62ec\u6570\u636e\u78c1\u76d8\u8fd9\u4e00\u7279 \u6b8a\u53c2\u6570\uff1a\n\n\u6bcf\u53f0\u670d\u52a1\u5668\u7684\u6570\u636e\u78c1\u76d8\u6570\u91cf\u4e0d\u56fa\u5b9a\uff0c\u53ef\u80fd\u662f0\u4e2a(\u6ca1\u6709\u6570\u636e\u78c1\u76d8)\uff0c\u4e5f\u53ef\u80fd\u662f\u591a\u4e2a\uff0c\u4f46\u5927\u90e8\u5206\u670d\u52a1\u5668\u90fd\u662f\u4e00\u4e2a\u6570\u636e\u78c1\u76d8\u3002\n\n\u6bcf\u4e00\u4e2a\u6570\u636e\u78c1\u76d8\u90fd\u6709\u78c1\u76d8ID\u3001\u78c1\u76d8\u5927\u5c0f\u7b49\u53c2\u6570\u3002\n\n\n\u539f\u59cb\u6570\u636e\uff1a\n\n\u4e09\u5757\u6570\u636e\u78c1\u76d8\n(&#39;instanceId&#39;: &#39;ins-olfzusjv&#39;,&#39;instanceType&#39;: &#39;M2.MEDIUM16&#39;,&#39;cpu&#39;: 2, &#39;memory&#39;: 16, &#39;instanceName&#39;:&#39;\u8fd0\u7ef4\u6d4b\u8bd5 1-\u516c\u7528&#39;cre atedTime&#39;: &#39;2019-11-14T04:57:06Z&#39;, &#39;expiredTime&#39;: &#39;2020-05-14T04:57:11Z&#39;, &#39;bandwidthOut&#39;: 1, &#39;systemDiskID&#39;: &#39;disk-3u84a3q 5&#39;, &#39;systemDiskSize&#39;: 50, &#39;dataDisks&#39;: [(&#39;DiskSize&#39;: 200, &#39;DiskType&#39;: &#39;CLOUD_SSD&#39;, &#39;DiskId&#39;: &#39;disk-0sw362zd&#39;, &#39;DeleteWithI nstance&#39;: None), (&#39;DiskSize&#39;: 110, &#39;DiskType&#39;: &#39;CLOUD_BASIC&#39;, &#39;DiskId&#39;: &#39;disk-nt2s8z11&#39;, &#39;DeleteWithInstance&#39;: None), (&#39;Di skSize&#39;: 100, &#39;DiskType&#39;: &#39;CLOUD_BASIC&#39;, &#39;DiskId&#39;: &#39;disk-h00ds6mt&#39;, &#39;DeleteWithInstance&#39;: None)])\n\n\n\u65e0\u6570\u636e\u76d8\n(&#39;instanceId&#39;: &#39;ins-olfzusjv&#39;, &#39;instanceType&#39;: &#39;M2.MEDIUM16&#39;, &#39;cpu&#39;: 2, &#39;memory&#39;: 16, &#39;instanceName&#39;:&#39;\u8fd0\u7ef4\u6d4b\u8bd5 1-\u516c\u7528&#39;cre atedTime&#39;: &#39;2019-11-14T04:57:06Z&#39;, &#39;expiredTime&#39;: &#39;2020-05-14T04:57:11Z&#39;, &#39;bandwidthOut&#39;: 1, &#39;systemDiskID&#39;: &#39;disk-3u84a3q 5&#39;, &#39;systemDiskSize&#39;: 50, &#39;dataDisks&#39;: None)\n\n\n\u4f7f\u7528\u4e24\u4e2a\u6a21\u578b\u5b58\u50a8\u6570\u636e\uff1as ervers\u6a21\u578b\u7528\u4e8e\u5b58\u50a8\u670d\u52a1\u5668\u7684\u5e38\u89c4\u3001\u666e\u901a\u53c2\u6570\u5bf9\u5e94\u7684\u6570\u636e\uff0cdatadisk\u6a21\u578b\u7528\u4e8e\u5b58\u50a8\u6570\u636e\u78c1\u76d8\u7684\u6570\u636e\u3002\n\n\u6570\u636e\u78c1\u76d8\u7684\u6570\u636e\u5728\u4f20\u5165\u524d\u8fdb\u884c\u5904\u7406\uff0c\u786e\u4fdd\u6570\u636e\u78c1\u76d8\u4e0d\u5b58\u5728\u65f6\uff0c\u5b83\u7684\u503c\u662f\u4e00\u4e2a\u7a7a\u5217\u8868\uff0c\u800c\u4e0d\u662fNon e\u6216null\u3002\n\n\u901a\u8fc7\u8c03\u7528API\u63a5\u53e3\u7684\u65b9\u5f0f\uff0c\u4f7f\u7528post\u65b9\u6cd5\u624b\u52a8\u4f20\u5165\u6570\u636e\u3002\n\n\n2. code\n2.1 \u521b\u5efa\u6a21\u578b\nfrom django.db import models\n\nclass Servers(models.Model):\n    instanceld = models.CharField(&#39;\u670d\u52a1\u5668\u5b9e\u4f8b ID&#39;, max_length=32, db_index=True, help_text=&#39;\u670d\u52a1\u5668\u5b9e\u4f8b ID&#39;)\n    instanceType = models.CharField(&#39;\u670d\u52a1\u5668\u5b9e\u4f8b\u7c7b\u578b\u2019\uff0cmax_length=32, help_text=&#39;\u670d\u52a1\u5668\u5b9e\u4f8b\u7c7b\u578b&#39;)\n    cpu = models.CharField(&#39;CPU \u6838\u6570&#39;,max_length=5, help_text=&#39;CPU&#39;, help_text=&#39;CPU \u6838\u6570&#39;)\n    memory = models.CharField(&#39;\u5185\u5b58\u5927\u5c0f(GB)&#39;, max_length=10, help_text=&#39;\u5185\u5b58\u5927\u5c0f(GB)&#39;)\n\nclass DataDisk(models.Model):\n    server = models.ForeignKey(Servers,null=True)\n    dataDiskID = models.CharField(&#39;\u7cfb\u7edf\u78c1\u76d8\u5bb9\u91cf\u2019\uff0cmax_length=32, help_text=&#39;\u7cfb\u7edf\u78c1\u76d8\u5bb9\u91cf&#39;)\n    dataDiskSize = models.CharField(&#39;\u7cfb\u7edf\u78c1\u76d8\u5bb9\u91cf\u2019\uff0cmax_length=10, help_text=&#39;\u7cfb\u7edf\u78c1\u76d8\u5bb9\u91cf&#39;)\n\n2.2 \u521b\u5efa\u5e8f\u5217\u5316\u7c7b\nfrom rest_framework import serializers\nfrom .models import Servers, DataDisk\n#\u5fc5\u987b\u6ce8\u610f\u5e8f\u5217\u5316\u65f6\u5b9a\u4e49\u7684\u5b57\u6bb5\u548c\u4f20\u5165\u5b57\u6bb5\u7684\u4e00\u81f4\u6027(\u540d\u79f0\u3001\u6570\u636e\u7c7b\u578b\u90fd\u8981\u4e00\u81f4)\uff0c\u5982\u679c\u4e0d\u4e00\u81f4\u5219\u65e0\u6cd5\u83b7\u53d6\u76f8\u5173\u6570\u636e\nclass ServerSerializer(serializers.Serializer):\n  id = serializers.ReadOnlyField()\n  instanceId = serializers.CharField(required=True)\n  cpu = serializers.CharField(required=True)\n  memory = serializers.CharField(required=True)\n  dataDisks = serializers.ListField(required=False, write_only=True)\n  #to_internal_value\u662f\u53cd\u5e8f\u5217\u5316\u7684\u7b2c\u4e00\u6b65 #\u5b83\u5c06\u4f20\u5165\u7684diet\u7684\u952e\u503c\u5bf9\u8f6c\u6362\u6210\u4e8c\u5143\u5143\u7ec4\n  #\u5982\u679c\u9700\u8981\u5bf9\u4f20\u5165\u7684\u539f\u59cb\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539\uff0c\u5219\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u5b8c\u6210\n  def to_internal_value(self, data):\n    return super(ServerSerializer, self).to_internal_value(data)\n\n  #\u5b57\u6bb5\u7ea7\u522b\u7684\u9a8c\u8bc1\u662f\u5728\u6a21\u578b\u7ea7\u522b\u7684\u9a8c\u8bc1\u4e4b\u524d\u8fdb\u884c\u7684\n  #\u5b57\u6bb5\u7ea7\u522b\u7684\u9a8c\u8bc1\u8fd4\u56de\u4e00\u4e2ainstance\n  #\u5982\u679c\u9700\u8981\u5bf9\u7279\u5b9a\u5b57\u6bb5\u8fdb\u884c\u9a8c\u8bc1\uff0c\u5219\u9700\u8981\u5b9e\u73b0\u5b57\u6bb5\u9a8c\u8bc1\u51fd\u6570\n  #\u5b57\u6bb5\u9a8c\u8bc1\u51fd\u6570\u7684\u540d\u79f0\u4ee5\u2019validate.&#39;\u4e3a\u524d\u7f00\uff0c\u540e\u9762\u8ddf\u4e0a\u6a21\u578b\u4e2d\u5b9a\u4e49\u7684\u5b57\u6bb5\u540d\u3002\u5982:validate_dataDisks\n  #\u5b57\u6bb5\u7ea7\u522b\u7684\u9a8c\u8bc1\u793a\u4f8b\u5982\u4e0b:\n  #def validate_manufacturer(self, value):\n  #  &#39;&#39;&#39;\n  #  \u5b57\u6bb5\u7ea7\u522b\u7684\u9a8c\u8bc1\u3002\u8fd4\u56de\u4e00\u4e2ainstance \u9a8c\u8bc1\u5236\u9020\u5546\u8bb0\u5f55\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219\u521b\u5efa\u5e76\u8fd4\u56de\u4e00\u4e2ainstance\uff0c\u5982\u679c\u5b58\u5728\u5219\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2ainstance\n  #  &#39;&#39;&#39;\n  #  try:\n  #   return Manufacturer.objects.get(vendor_name_exact=value)\n  # except Manufacturer.DoesNotExist:\n  #   return self.create_manufacturer(value)\n\n  #validate\u65b9\u6cd5\u662f\u6a21\u578b\u7ea7\u522b\u7684\u9a8c\u8bc1\n  #\u53ea\u6709\u7ecf\u8fc7\u6a21\u578b\u9a8c\u8bc1\u540e\u7684\u6570\u636e\u624d\u4f1a\u88ab\u4f20\u7ed9create\u3001update\u65b9\u6cd5\n  #\u6a21\u578b\u7ea7\u522b\u7684\u9a8c\u8bc1\u793a\u4f8b\u5982\u4e0b:\n  # def validate(self, attrs):\n  #   &#39;&#39;&#39;\n  #   \u5bf9\u8c61\u7ea7\u522b\u7684\u9a8c\u8bc1\u3002\u9a8c\u8bc1\u670d\u52a1\u5668\u578b\u53f7\u3002\u5148\u62ff\u5230\u5236\u9020\u5546\u7684instance,\u7136\u540e\u67e5\u627e\u8be5\u5236\u9020\u5546\u5bf9\u5e94\u7684\u8bb0\u5f55\u662f\u5426\u5b58\u5728\u8be5\u578b\u53f7\n  #   &#39;&#39;&#39;\n  #   manufacturer_obj = attrs[&quot;manufacturer&quot;] \n  #   try:\n  #     attrs[&quot;model_name&quot;] = manufacturer_obj.productmodel_set.get(model_name_exact=attrs[&quot;model_name&quot;]) \n  #     except \n  #     ProductModel.DoesNotExist:\n  #     attrs[&quot;model_name&quot;] = self.create_product_model(manufacturer_obj, attrs[&quot;model_name&quot;])\n  #   return attrs\n  #\u65b0\u589e\u6570\u636e\u548c\u66f4\u65b0\u6570\u636e\u7684\u64cd\u4f5c\u5927\u540c\u5c0f\u5f02\uff0c\u533a\u522b\u5728\u4e8e\u4f20\u5165\u5230\u51fd\u6570\u7684\u53c2\u6570\u4e2d\u662f\u5426\u5305\u542binstance \n  #\u5982\u679c\u6709instance\uff0c\u5219\u662f\u6570\u636e\u66f4\u65b0\uff0c\u5426\u5219\u5c31\u662f\u65b0\u589e\u6570\u636e\n\n  #create\u65b9\u6cd5\u63a5\u6536\u9a8c\u8bc1\u540e\u7684\u6570\u636e\uff0c\u5e76\u5c06\u6570\u636e\u4fdd\u5b58\u5230\u6570\u636e\u5e93\u4e2d\n  #\u5982\u679c\u6d89\u53ca\u5230\u6a21\u578b\u7684\u5173\u8054\u5173\u7cfb\uff0c\u5373\u6570\u636e\u8981\u5b58\u5165\u5230\u591a\u5f20\u8868\u4e2d\uff0c\u5219\u6309\u4e0b\u9762\u7684\u601d\u8def\u64cd\u4f5c:\n  #\u5c06\u5173\u8054\u8868\u7684\u6570\u636e\u5355\u72ec\u4ecevalidated_data\u4e2d\u63d0\u53d6\u51fa\u6765\uff0c\u5e76\u4f20\u5165\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\u4e2d\uff0c\u901a\u8fc7\u8be5\u81ea\u5b9a\u4e49\u51fd\u6570\u5b8c\u6210\u5173\u8054\u6a21\u578b\u6570\u636e\u7684\u5199\u5165\n  #\u793a\u4f8b\u5982\u4e0b:\n  def create(self, validated_data):\n    instanceId = validated_data[&quot;instanceId&quot;]\n    instance = self.getlnstance(instanceId)\n    dataDisks = validated_data.pop(&quot;dataDisks&quot;)\n      # print(dataDisks)\n      if instance is not None:\n        self.check_data_disk(instance, dataDisks)\n        return self.update(instance, validated_data)\n      else:\n        instance = Servers.objects.create(**validated_data)\n        self.check_data_disk(instance, dataDisks)\n        return instance\n  # update\u65b9\u6cd5\u63a5\u6536instance\u548cvalidated_data\uff0c\u5c06\u6307\u5b9a\u7684\u5b57\u6bb5\u6570\u636e\u66f4\u65b0\u5199\u5165\u5230\u6570\u636e\u5e93\u4e2d\n\n  #\u5982\u679c\u6d89\u53ca\u6a21\u578b\u7684\u5173\u8054\u5173\u7cfb\uff0c\u5219\u9700\u8981\u8c03\u7528\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\u6765\u5b9e\u73b0\u5173\u8054\u8868\u7684\u66f4\u65b0\u64cd\u4f5c\n  def update(self, instance, validated_data):\n    instance.cpu = validated_data.get(&quot;cpu&quot;,&quot;&quot;)\n    instance.memory = validated_data.get(&quot;memory&quot;,&quot;&quot;)\n    instance.save()\n    return instance\n\n  #\u83b7\u53d6\u670d\u52a1\u5668\u5b9e\u4f8b\n  def getInstance(self, instanceId):\n    try:\n      return Servers.objects.get(instanceId_exact=instanceId)\n    except Servers.DoesNotExist:\n      return None\n    except Exception as e:\n      raise serializers.ValidationError(&quot;\u670d\u52a1\u5668\u9519\u8bef:{)&quot;.format(e))\n\n  #\u5bf9\u5173\u8054\u6a21\u578b\u64cd\u4f5c\u7684\u81ea\u5b9a\u4e49\u51fd\u6570\n  #\u8be5\u51fd\u6570\u5b9e\u73b0\u4e86\u5bf9\u78c1\u76d8\u4fe1\u606f\u7684\u589e\u3001\u5220\u3001\u6539\n  def check_data_disk(self, instance, dataDisks):\n    data_disk_queryset = instance.datadisk_set.all()\n    current_data_disk =[]\n    for datadisk in dataDisks:\n      try:\n        data_disk_obj = data_disk_queryset.get(dataDiskID_exact=datadisk[&#39;DiskId&#39;])\n      except DataDisk.DoesNotExist:\n        data_disk_obj = DataDisk.objects.create(dataDiskID=datadisk[&#39;DiskId&#39;], dataDiskSize=datadisk[&#39;DiskSize&#39;],server=instance)\n          current_data_disk.append(data_disk_obj)\n\n    self.cleanDisk(data_disk_queryset, current_data_disk)\n\n  #\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u7528\u4e8e\u5220\u9664\u591a\u4f59\u7684\u78c1\u76d8\u8bb0\u5f55\n  def cleanDisk(self, data_disk_queryset, current_data_disk):\n    not_exists_disk = set(data_disk_queryset) - set(current_data_disk)\n    for obj in not_exists_disk:\n      obj.delete()\n\n  # to_representation\u51fd\u6570\u662f\u5e8f\u5217\u5316\u7684\u6700\u540e\u4e00\u6b65\uff0c\u5982\u679c\u9700\u8981\u5bf9\u5e8f\u5217\u5316\u7684\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539\uff0c\u5219\u5728\u8be5\u51fd\u6570\u4e2d\u5b9e\u73b0\n  #\u7531\u4e8e\u6d89\u53ca\u6a21\u578b\u5173\u8054\uff0c\u6240\u4ee5\u9700\u8981\u5bf9\u8fd4\u56de\u7ed9\u524d \u7aef\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\n  #\u901a\u8fc7\u6a21\u578b\u5173\u7cfb\u53d6\u51fa\u6570\u636e\u78c1\u76d8\u7684\u76f8\u5173\u6570\u636e\uff0c\u5e76\u589e\u52a0\u5230\u9700\u8981\u8fd4\u56de\u7ed9\u524d\u7aef\u7684\u6570\u636e\u4e2d\n  def to_representation(self, instance):\n    ret = super(ServerSerializer, self).to_representation(instance)\n    disks = instance.datadisk_set.all().values()\n    disks_list =[]\n    for i in disks:\n      disks_list.append(i)\n    ret[&quot;dataDisks&quot;] = disks_list\n    return ret\n\n2.3 \u521b\u5efa\u89c6\u56fe\nfrom rest_framework import viewsets\nfrom .serializers import ServerSerializer\nfrom .models import Servers\nclass ServerViewset(viewsets.ModelViewSet):\n    queryset = Servers.objects.all()\n    serializer_class = ServerSerializer\n\n2.4 URL\nfrom server.views import ServerViewset\nroute.register(&#39;servers&#39;,ServerViewset,base_name=&#39;servers&#39;)\n\nurlpatterns = [\n    url(r&#39;^&#39;, include(route.urls)),\n  ]\n\n", "categories": [{"name": "devops", "slug": "devops", "permalink": "/category/devops/"}], "tags": [{"name": "Django", "slug": "Django", "permalink": "/tag/Django/"}, {"name": "Python", "slug": "Python", "permalink": "/tag/Python/"}, {"name": "DRF", "slug": "DRF", "permalink": "/tag/DRF/"}]}, {"title": "mysql \u811a\u672c\u6c47\u603b", "date": "2019-12-27T16:23:00-00.00", "path": "/archives/mysql_scripts/", "text": "\n\u5220\u9664\u5927\u6570\u636e\u8868\n\n#!/bin/bash\n#\ndbname=&#39;dbname&#39;\ntabname=&#39;tablename&#39;\nstep=&#39;10000&#39;\nsleeptime=1\nstart_index=30000001\nend_index=39938589\nMYSQL=&quot;mysql -u[user] -p[password] -t -e &quot;\n\ni_start=$start_index\ni_end=$(expr &quot;$start_index&quot; + &quot;$step&quot;)\ni_end=$(expr &quot;$i_end&quot; - 1)\nif [ $i_end -gt $end_index ]; then\n  i_end=$end_index\nfi\nwhile [ $i_end -le $end_index ]; do\n    echo &quot;start delete from $i_start to $i_end&quot;\n    mysql delete delete from yitain where id &gt;= $i_start and id &lt;= $i_end\n    #$MYSQL &quot;delete from $dbname.$tabname where id &gt;= $i_start and id &lt;= $i_end;&quot;\n    i_start=$(expr &quot;$i_end&quot; + 1)\n    i_end=$(expr &quot;$i_end&quot; + &quot;$step&quot;)\n    if [ $i_start -gt $end_index ]; then\n        break\n    fi\n    if [ $i_end -gt $end_index ]; then\n      i_end=$end_index\n    fi\n    sleep $sleeptime\ndone\n\n\n\u7edf\u8ba1\u6700\u5927\u7684\u524d\u5341\u4e2a\u8868\n\n#!/bin/bash\nMYSQL=&quot;mysql -u[user] -t -e &quot;\nTMP_FILE=biggest_table.txt\n\necho &quot;db \u6700\u5927\u7684\u5341\u5f20\u8868&quot; &gt;$TMP_FILE\n\n$MYSQL &quot;SELECT CONCAT(table_schema, &#39;.&#39;, table_name), CONCAT(ROUND(table_rows / 1000000, 2), &#39;M&#39;) rows, CONCAT(ROUND(data_length / ( 1024 * 1024 * 1024 ), 2), &#39;G&#39;)                    DATA, CONCAT(ROUND(index_length / ( 1024 * 1024 * 1024 ), 2), &#39;G&#39;)                   idx,CONCAT(ROUND(( data_length + index_length ) / ( 1024 * 1024 * 1024 ), 2), &#39;G&#39;) total_size,ROUND(index_length / data_length, 2)                                           idxfrac FROM   information_schema.TABLES where table_schema = &#39;db&#39; ORDER  BY data_length + index_length DESC LIMIT  10;&quot; &gt;&gt;$TMP_FILE\n\n\n\u68c0\u67e5Mariadb galera\u96c6\u7fa4\u7684\u5065\u5eb7\u72b6\u6001\n\n#/bin/bash\n\nMYSQL_USERNAME=&quot;root&quot;\n\nif $1; then\n    MYSQL_PASSWORD=&quot;{{ mysql_root_pass }}&quot;\nelse\n    MYSQL_PASSWORD=&quot;&quot;\nfi\n\nERR_FILE=&quot;/dev/null&quot;\nDEFAULTS_EXTRA_FILE=&quot;/etc/my.cnf&quot;\nTIMEOUT=10\nEXTRA_ARGS=&quot;&quot;\n\nfunction service_status()\n {\n    if [[ -n &quot;$MYSQL_USERNAME&quot; ]]; then\n        EXTRA_ARGS=&quot;$EXTRA_ARGS --user=${MYSQL_USERNAME}&quot;\n    fi\n    if [[ -n &quot;$MYSQL_PASSWORD&quot; ]]; then\n        EXTRA_ARGS=&quot;$EXTRA_ARGS --password=${MYSQL_PASSWORD}&quot;\n    fi\n\n    if [[ -r $DEFAULTS_EXTRA_FILE ]];then\n        MYSQL_CMDLINE=&quot;/usr/local/mysql/bin/mysql --defaults-extra-file=$DEFAULTS_EXTRA_FILE -nNE --connect-timeout=$TIMEOUT \\\n                        --user=${MYSQL_USERNAME} --password=${MYSQL_PASSWORD}&quot;\n    else\n        MYSQL_CMDLINE=&quot;/usr/local/mysql/bin/mysql -nNE --connect-timeot=$TIMEOUT --user=${MYSQL_USERNAME} --password=${MYSQL_PASSWORD}&quot;\n    fi\n\n    wsrep_local_state=$($MYSQL_CMDLINE -e &quot;SHOW STATUS LIKE &#39;wsrep_local_state&#39;;&quot; 2&gt;${ERR_FILE} | tail -1 2&gt;&gt;${ERR_FILE})\n    wsrep_local_state_comment=$($MYSQL_CMDLINE -e &quot;SHOW STATUS LIKE &#39;wsrep_local_state_comment&#39;;&quot; 2&gt;${ERR_FILE} | tail -1 2&gt;&gt;${ERR_FILE})\n    wsrep_cluster_status=$($MYSQL_CMDLINE -e &quot;SHOW STATUS LIKE &#39;wsrep_cluster_status&#39;;&quot; 2&gt;${ERR_FILE} | tail -1 2&gt;&gt;${ERR_FILE})\n\n    if [[ &quot;${wsrep_cluster_status}&quot; == &quot;Primary&quot; ]] &amp;&amp; [[ &quot;${wsrep_local_state_comment}&quot; == &quot;Synced&quot; &amp;&amp; &quot;${wsrep_local_state}&quot; == &quot;4&quot; ]]\n    then\n        echo &quot;true&quot;\n    else\n        echo &quot;false&quot;\n    fi\n }\n\nfunction exec_next()\n{\n    taga=&quot;true&quot;\n    while $taga\n    do\n        if `service_status`; then\n            taga=&quot;false&quot;\n        else\n            sleep 5s\n        fi\n    done\n}\n\n`exec_next`#u\n\n", "categories": [{"name": "devops", "slug": "devops", "permalink": "/category/devops/"}], "tags": [{"name": "mysql", "slug": "mysql", "permalink": "/tag/mysql/"}, {"name": "shell", "slug": "shell", "permalink": "/tag/shell/"}]}, {"title": "ansible keywords", "date": "2019-12-25T20:15:00-00.00", "path": "/archives/my-first-awesome-post/", "text": "ansible 2.9 \u7248\u672c\n\nPlay\n\u5728 play \u4e0b\u53ef\u7528\u7684\u5173\u952e\u5b57\n\n\n\nkey\ndesc\n\n\n\n\nalways_run\n\u5373\u4f7f\u5728\u68c0\u67e5\u6a21\u5f0f\u4e0b\u4e5f\u5f3a\u5236\u4efb\u52a1\u8fd0\u884c\n\n\nany_errors_fatal\n\u6709\u4efb\u52a1\u9519\u8bef\u65f6\uff0c\u7acb\u5373\u505c\u6b62\n\n\nbecome\n\u662f\u5426\u63d0\u6743\n\n\nbecome_exe\n\n\n\nbecome_flags\n\u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570\n\n\nbecome_method\n\u63d0\u6743\u5f97\u65b9\u5f0f\n\n\nbecome_user\n\u63d0\u6743\u7684\u7528\u6237\n\n\ncheck_mode\n\u5f53\u4e3a True \u65f6\uff0c\u53ea\u68c0\u67e5\uff0c\u4e0d\u505a\u4fee\u6539\n\n\ncollections\n\n\n\nconnection\n\u8fde\u63a5\u65b9\u5f0f\n\n\ndebugger\n\u5f00\u542f debugger \u6a21\u5f0f\n\n\ndiff\n\u5bf9\u6bd4\u66f4\u6539\u7684\u6587\u4ef6\n\n\nenvironment\n\u5b9a\u4e49\u8fdc\u7aef\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf\n\n\nfact_path\n\u6307\u5b9a\u5b58\u50a8 fact \u7684\u76ee\u5f55\n\n\nforce_handlers\n\u4efb\u52a1\u5931\u8d25\u540e\uff0c\u662f\u5426\u4f9d\u7136\u6267\u884c handlers \u4e2d\u7684\u4efb\u52a1\n\n\ngather_facts\n\u662f\u5426\u83b7\u53d6\u8fdc\u7aef\u7cfb\u7edf\u5f97 facts\n\n\ngather_subset\n\u83b7\u53d6 facts \u5f97\u54ea\u4e9b\u952e\u503c\n\n\ngather_timeout\n\u83b7\u53d6 facts \u7684\u8d85\u65f6\u65f6\u95f4\n\n\nhandlers\n\u5b9a\u4e49 task \u6267\u884c\u5b8c\u6210\u4ee5\u540e\u9700\u8981\u8c03\u7528\u7684\u4efb\u52a1\n\n\nhosts\n\u6307\u5b9a\u8fd0\u884c\u5f97\u4e3b\u673a\n\n\nignore_errors\n\u5e03\u5c14\u503c\uff0c\u662f\u5426\u5ffd\u7565\u9519\u8bef\n\n\nignore_unreachable\n\u5e03\u5c14\u503c\uff0c\u53ef\u4ee5\u5ffd\u7565\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u5e76\u7ee7\u7eed\n\n\nmax_fail_percentage\n\u5355\u4f4d\u767e\u5206\u6bd4\u3002\u6700\u5927\u7684\u9519\u8bef\u4e3b\u673a\u6570\uff0c\u8d85\u8fc7\u5219\u7acb\u5373\u505c\u6b62 ansbile\n\n\nmodule_defaults\n\u6307\u5b9a\u6a21\u5757\u7684\u9ed8\u8ba4\u53c2\u6570\u503c\u3002\n\n\nname\n\u5b9a\u4e49\u540d\u79f0\n\n\nno_log\n\u4e0d\u8bb0\u5f55\u65e5\u5fd7\n\n\norder\n\u6267\u884c\u4e3b\u673a\u7684\u987a\u5e8f\n\n\nport\n\u5b9a\u4e49 ssh \u7684\u8fde\u63a5\u7aef\u53e3\n\n\npost_tasks\n\u6267\u884c\u4efb\u52a1\u540e\u8981\u6267\u884c\u7684\u4efb\u52a1\n\n\npre_tasks\n\u6267\u884c\u4efb\u52a1\u524d\u8981\u6267\u884c\u7684\u4efb\u52a1\n\n\nremote_user\n\u8fdc\u7a0b\u767b\u9646\u7684\u7528\u6237\n\n\nroles\n\u5b9a\u4e49\u89d2\u8272\n\n\nrun_once\n\u4efb\u52a1\u53ea\u8fd0\u884c\u4e00\u6b21\n\n\nserial\n\u4efb\u52a1\u6bcf\u6b21\u6267\u884c\u7684\u4e3b\u673a\u6570\n\n\nstrategy\nplay \u8fd0\u884c\u7b56\u7565\n\n\ntags\n\u6807\u8bb0\u6807\u7b7e\n\n\ntasks\n\u5b9a\u4e49\u4efb\u52a1\n\n\nthrottle\n\u9650\u5236\u5e76\u53d1\u4efb\u52a1\u5728 tasks\uff0cblocks \u548c playbook \u7ea7\u522b\u4e0a\u8fd0\u884c\u7684\u6570\u91cf\u3002\u4e0d\u80fd\u9ad8\u4e8e serial \u548c forks \u6570\n\n\nvars\n\u5b9a\u4e49\u53d8\u91cf\n\n\nvars_files\n\u5305\u542b\u53d8\u91cf\u6587\u4ef6\n\n\nvars_prompt\n\u8981\u6c42\u7528\u6237\u8f93\u5165\u5185\u5bb9\n\n\n\nRole\n\u5728 role \u4e0b\u53ef\u7528\u7684\u5173\u952e\u5b57\n\n\n\nkey\ndesc\n\n\n\n\nany_errors_fatal\n\u6709\u4efb\u52a1\u9519\u8bef\u65f6\uff0c\u7acb\u5373\u505c\u6b62\n\n\nbecome\n\u662f\u5426\u63d0\u6743\n\n\nbecome_exe\n\n\n\nbecome_flags\n\u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570\n\n\nbecome_method\n\u63d0\u6743\u7684\u65b9\u5f0f\n\n\nbecome_user\n\u63d0\u6743\u7684\u7528\u6237\n\n\ncheck_mode\n\u5f53\u4e3a True \u65f6\uff0c\u53ea\u68c0\u67e5\uff0c\u4e0d\u505a\u4fee\u6539\n\n\ncollections\n\n\n\nconnection\n\u8fde\u63a5\u65b9\u5f0f\n\n\ndebugger\n\u5f00\u542f debugger \u6a21\u5f0f\n\n\ndiff\n\u5bf9\u6bd4\u66f4\u6539\u7684\u6587\u4ef6\n\n\ndelegate_facts\n\u59d4\u6258 facts\n\n\ndelegate_to\n\u4efb\u52a1\u59d4\u6d3e\n\n\nenvironment\n\u5b9a\u4e49\u8fdc\u7aef\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf\n\n\nignore_errors\n\u662f\u5426\u5ffd\u7565\u9519\u8bef\n\n\nignore_unreachable\n\u5e03\u5c14\u503c\uff0c\u53ef\u4ee5\u5ffd\u7565\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u5e76\u7ee7\u7eed\n\n\nmodule_defaults\n\u6307\u5b9a\u6a21\u5757\u7684\u9ed8\u8ba4\u53c2\u6570\u503c\u3002\n\n\nname\n\u5b9a\u4e49\u4efb\u52a1\u5f97\u540d\u79f0\n\n\nno_log\n\u4e0d\u8bb0\u5f55\u65e5\u5fd7\n\n\nport\n\u5b9a\u4e49 ssh \u7684\u8fde\u63a5\u7aef\u53e3\n\n\nremote_user\n\u8fdc\u7aef\u7cfb\u7edf\u7684\u6267\u884c\u7528\u6237\n\n\nrun_once\n\u53ea\u8fd0\u884c\u4e00\u6b21\n\n\ntags\n\u6807\u8bb0\u6807\u7b7e\n\n\nthrottle\n\u9650\u5236\u5e76\u53d1\u4efb\u52a1\u5728 tasks\uff0cblocks \u548c playbook \u7ea7\u522b\u4e0a\u8fd0\u884c\u7684\u6570\u91cf\u3002\u4e0d\u80fd\u9ad8\u4e8e serial \u548c forks \u6570\n\n\nvars\n\u5b9a\u4e49\u53d8\u91cf\n\n\nwhen\n\u6761\u4ef6\u8868\u8fbe\u5f0f\u7ed3\u679c\u4e3a True \u5219\u6267\u884c role\n\n\n\nBlock\n\u5728 block \u4e0b\u53ef\u7528\u7684\u5173\u952e\u5b57\n\n\n\nkey\ndesc\n\n\n\n\nalways\nBlock \u4e2d\u6267\u884c\u7684\u4efb\u52a1\u5217\u8868\uff0c\u65e0\u8bba\u662f\u5426\u5b58\u5728\u9519\u8bef\u90fd\u4f1a\u6267\u884c\u3002\n\n\nany_errors_fatal\n\u6709\u9519\u8bef\u65f6\u7acb\u5373\u4e2d\u65ad ansbile\n\n\nbecome\n\u662f\u5426\u63d0\u6743\n\n\nbecome_exe\n\n\n\nbecome_flags\n\u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570\n\n\nbecome_method\n\u63d0\u6743\u7684\u65b9\u5f0f\n\n\nbecome_user\n\u63d0\u6743\u7684\u7528\u6237\n\n\nblock\n\u5206\u7ec4\u91cc\u7684\u4efb\u52a1\u5217\u8868\n\n\ncheck_mode\n\u5f53\u4e3a True \u65f6\uff0c\u53ea\u68c0\u67e5\uff0c\u4e0d\u505a\u4fee\u6539\n\n\ncollections\n\n\n\nconnection\n\u8fde\u63a5\u65b9\u5f0f\n\n\ndebugger\n\u5f00\u542f debugger \u6a21\u5f0f\n\n\ndelegate_facts\n\u5e03\u5c14\u503c\uff0c\u5c06 facts \u5e94\u7528\u4e8e\u59d4\u6d3e\u7684\u4e3b\u673a\u3002\n\n\ndelegate_to\n\u4efb\u52a1\u59d4\u6d3e\n\n\ndiff\n\u5bf9\u6bd4\u66f4\u6539\u7684\u6587\u4ef6\n\n\nenvironment\n\u5b9a\u4e49\u8fdc\u7aef\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf\n\n\nignore_errors\n\u662f\u5426\u5ffd\u7565\u9519\u8bef\n\n\nignore_unreachable\n\u5e03\u5c14\u503c\uff0c\u53ef\u4ee5\u5ffd\u7565\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u5e76\u7ee7\u7eed\n\n\nmodule_defaults\n\u6307\u5b9a\u6a21\u5757\u7684\u9ed8\u8ba4\u53c2\u6570\u503c\u3002\n\n\nname\n\u5b9a\u4e49 block \u540d\u79f0\n\n\nno_log\n\u4e0d\u8bb0\u5f55\u65e5\u5fd7\n\n\nport\n\u5b9a\u4e49 ssh \u7684\u8fde\u63a5\u7aef\u53e3\n\n\nremote_user\n\u8fdc\u7aef\u7cfb\u7edf\u7684\u6267\u884c\u7528\u6237\n\n\nrescue\nblock \u4e2d\u7684\u4efb\u52a1\u5728\u6267\u884c\u4e2d\uff0c\u5982\u679c\u6709\u4efb\u4f55\u9519\u8bef\uff0c\u5c06\u6267\u884c rescue \u4e2d\u7684\u4efb\u52a1\u3002\n\n\nrun_once\n\u53ea\u8fd0\u884c\u4e00\u6b21\n\n\ntags\n\u6807\u8bb0\u6807\u7b7e\n\n\nthrottle\n\u9650\u5236\u5e76\u53d1\u4efb\u52a1\u5728 tasks\uff0cblocks \u548c playbook \u7ea7\u522b\u4e0a\u8fd0\u884c\u7684\u6570\u91cf\u3002\u4e0d\u80fd\u9ad8\u4e8e serial \u548c forks \u6570\n\n\nvars\n\u5b9a\u4e49\u53d8\u91cf\n\n\nwhen\n\u6761\u4ef6\u8868\u8fbe\u5f0f\u7ed3\u679c\u4e3a True \u5219\u6267\u884c block\n\n\n\nTask\n\u5728 task \u4e0b\u53ef\u7528\u7684\u5173\u952e\u5b57\n\n\n\nkey\ndesc\n\n\n\n\naction\n\u6267\u884c\u52a8\u4f5c\n\n\nany_errors_fatal\n\u4e3a True \u65f6\uff0c\u53ea\u8981\u4efb\u52a1\u6709\u9519\u8bef\uff0c\u5c31\u7acb\u5373\u505c\u6b62 ansible\n\n\nargs\n\u5b9a\u4e49\u4efb\u52a1\u5f97\u53c2\u6570\n\n\nasync\n\u662f\u5426\u5f02\u6b65\u6267\u884c\u4efb\u52a1\n\n\nbecome\n\u662f\u5426\u63d0\u6743\n\n\nbecome_exe\n\n\n\nbecome_flags\n\u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570\n\n\nbecome_method\n\u63d0\u6743\u7684\u65b9\u5f0f\n\n\nbecome_user\n\u63d0\u6743\u7684\u7528\u6237\n\n\nchanged_when\n\u6761\u4ef6\u8868\u8fbe\u5f0f\u4e3a True \u65f6\uff0c\u4f7f\u4efb\u52a1\u72b6\u6001\u4e3a changed\n\n\ncheck_mode\n\u4e3a True \u65f6\uff0c\u53ea\u68c0\u67e5\u8fd0\u884c\u72b6\u6001\uff0c\u5728\u8fdc\u7aef\u4e0d\u505a\u4efb\u4f55\u4fee\u6539\n\n\ncollections\n\n\n\nconnection\n\u8fde\u63a5\u65b9\u5f0f\n\n\ndebugger\n\u5f00\u542f debugger \u6a21\u5f0f\n\n\ndelay\n\u7b49\u5f85\u591a\u5c11\u79d2\uff0c\u624d\u6267\u884c\u4efb\u52a1\n\n\ndelegate_facts\n\u5e03\u5c14\u503c\uff0c\u5c06 facts \u5e94\u7528\u4e8e\u59d4\u6d3e\u7684\u4e3b\u673a\u3002\n\n\ndelegate_facts\n\u59d4\u6258 facts\n\n\ndelegate_to\n\u4efb\u52a1\u59d4\u6d3e\n\n\ndiff\n\u5bf9\u6bd4\u66f4\u6539\u7684\u6587\u4ef6\n\n\nenvironment\n\u5b9a\u4e49\u8fdc\u7aef\u7684\u73af\u5883\u53d8\u91cf\n\n\nfailed_when\n\u6761\u4ef6\u8868\u8fbe\u5f0f\u4e3a True \u65f6\uff0c\u4f7f\u4efb\u52a1\u4e3a\u5931\u8d25\u72b6\u6001\n\n\nignore_errors\n\u662f\u5426\u5ffd\u7565\u9519\u8bef\n\n\nignore_unreachable\n\u5e03\u5c14\u503c\uff0c\u53ef\u4ee5\u5ffd\u7565\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u5e76\u7ee7\u7eed\n\n\nlocal_action\n\u672c\u5730\u6267\u884c\n\n\nloop\n\u5faa\u73af\n\n\nloop_control\n\u6539\u53d8\u5faa\u73af\u7684\u53d8\u91cf\u9879\n\n\nmodule_defaults\n\u6307\u5b9a\u6a21\u5757\u7684\u9ed8\u8ba4\u53c2\u6570\u503c\u3002\n\n\nname\n\u5b9a\u4e49\u540d\u79f0\n\n\nno_log\n\u4e0d\u8bb0\u5f55\u65e5\u5fd7\n\n\nnotify\n\u7528\u4e8e\u4efb\u52a1\u6267\u884c\u5b8c\uff0c\u6267\u884c handlers \u91cc\u7684\u4efb\u52a1\n\n\npoll\n\u8f6e\u8be2\u65f6\u95f4\n\n\nport\n\u5b9a\u4e49 ssh \u7684\u8fde\u63a5\u7aef\u53e3\n\n\nregister\n\u6ce8\u518c\u53d8\u91cf\n\n\nremote_user\n\u8fdc\u7aef\u7cfb\u7edf\u7684\u6267\u884c\u7528\u6237\n\n\nretries\n\u91cd\u8bd5\u6b21\u6570\n\n\nrun_once\n\u53ea\u8fd0\u884c\u4e00\u6b21\n\n\ntags\n\u6807\u8bb0\u4e3a\u6807\u7b7e\n\n\nthrottle\n\u9650\u5236\u5e76\u53d1\u4efb\u52a1\u5728 tasks\uff0cblocks \u548c playbook \u7ea7\u522b\u4e0a\u8fd0\u884c\u7684\u6570\u91cf\u3002\u4e0d\u80fd\u9ad8\u4e8e serial \u548c forks \u6570\n\n\nuntil\n\u76f4\u5230\u4e3a\u771f\u65f6\uff0c\u624d\u7ee7\u7eed\u6267\u884c\u4efb\u52a1\n\n\nvars\n\u5b9a\u4e49\u53d8\u91cf\n\n\nwhen\n\u6761\u4ef6\u8868\u8fbe\u5f0f\uff0c\u7ed3\u679c\u4e3a True \u5219\u6267\u884c task\n\n\nwith_lookup_plugin\n\u5faa\u73af\u63d2\u4ef6\n\n\n\n", "categories": [{"name": "devops", "slug": "devops", "permalink": "/category/devops/"}], "tags": [{"name": "ansible", "slug": "ansible", "permalink": "/tag/ansible/"}, {"name": "\u535a\u5ba2", "slug": "\u535a\u5ba2", "permalink": "/tag/\u535a\u5ba2/"}]}], "pages": [{"title": "\u5173\u4e8e", "date": "2019-12-25T17:26:00-00.00", "path": "/about/", "text": "\u5efa\u8bbe\u8fd9\u91cc\u662f\u56e0\u4e3a\u60f3\u79ef\u7d2f\u4e00\u4e9b\u8d44\u6599\uff0c\u8bb0\u4f4f\u4e00\u4e9b\u5bb9\u6613\u5fd8\u6389\u7684\u4e8b\u60c5\u3002\nContact\nEmail: libiao163@gmail.com\n", "categories": [], "tags": []}]}